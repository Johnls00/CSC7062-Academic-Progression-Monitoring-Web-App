<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Academic Summary</title>
  <style>
    body {
      font-family: "Arial", sans-serif;
      margin: 20px;
      font-size: 12px;
      color: #333;
    }
    header {
      text-align: center;
      margin-bottom: 15px;
    }
    h1 {
      margin: 0;
      font-size: 20px;
    }
    .student-info,
    .summary-table {
      width: 100%;
      margin-bottom: 10px;
      border-collapse: collapse;
    }
    .student-info td {
      padding: 4px 6px;
    }
    .summary-table th,
    .summary-table td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: left;
      font-size: 11px;
    }
    .summary-table th {
      background-color: #f2f2f2;
    }
    .section-title {
      font-size: 16px;
      margin-top: 20px;
      margin-bottom: 8px;
      border-bottom: 1px solid #000;
      padding-bottom: 3px;
    }
    footer {
      margin-top: 20px;
      font-size: 10px;
      text-align: center;
      color: #666;
    }
    ul {
      margin: 5px 0;
      padding-left: 18px;
    }
    li {
      margin-bottom: 2px;
    }
  </style>
</head>
<body style="margin: 0; padding: 0;">
  <header>
    <h1>Academic Summary</h1>
    <p><strong>Queens University Belfast</strong></p>
  </header>

  <table class="student-info">
    <tr>
      <td><strong>Name:</strong> <%= student.first_name %> <%= student.last_name %></td>
      <td><strong>Student ID:</strong> <%= student.sId %></td>
    </tr>
    <tr>
      <td><strong>Student Email:</strong> <%= userData.email %></td>
      <td><strong>Secondary Email:</strong> <%= userData.secondary_email || "No email on file." %></td>
    </tr>
    <tr>
      <td><strong>Program:</strong> <%= student.program_name %></td>
      <td><strong>Academic Level:</strong> <%= studentRecord.studentLevel %></td>
      <td><strong>Student Study Status:</strong> <%= student.status_study %></td>
    </tr>
  </table>

  <div class="section-title">Module Performance</div>
  <table class="summary-table">
    <thead>
      <tr>
        <th>Module Code</th>
        <th>Module Name</th>
        <th>Credit Value</th>
        <th>Grade</th>
        <th>Result</th>
      </tr>
    </thead>
    <tbody>
      <% moduleData.forEach(module => { 
        const detail = studentRecord.modules.find(m => m.module_id === module.module_id); %>
      <tr>
        <td><%= module.subject_code + module.subject_catalog %></td>
        <td><%= module.module_title %></td>
        <td><%= module.credit_value %></td>
        <td><%= detail?.grade || "N/A" %></td>
        <td><%= detail?.result || "N/A" %></td>
      </tr>
      <% }); %>
    </tbody>
  </table>

  <div class="section-title">Summary</div>
  <table class="student-info">
    <tr>
      <td><strong>Total Credits Earned:</strong> 
        <% let totalCredits = 0; studentRecord.creditsPassed.forEach(level => { totalCredits += level.credits_passed }); %>
        <%= totalCredits %>
      </td>
      <td><strong>Average Grade:</strong> <%= parseFloat(studentRecord.averageMark).toFixed(2) %></td>
    </tr>
    <tr>
      <td><strong>Academic Progression Status:</strong> <%= studentProgression.outcome %></td>
      <td>
        <strong>Further Progression Details:</strong>
        <% if (studentProgression.reason && studentProgression.reason.length > 0) { %>
          <ul>
            <% studentProgression.reason.forEach(function(reason) { %>
              <li><%= reason %></li>
            <% }) %>
          </ul>
        <% } else { %> No further data available. <% } %>
      </td>
    </tr>
  </table>

  <footer>
    Generated on <%= dateGenerated %> &middot; Students Academic Record
  </footer>
</body>
</html>